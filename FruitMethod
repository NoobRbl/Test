-- Auto Moreira Method v8.1 (ESP + Bot Label) [FIXED - dÃ¹ng _G bridge]
-- =========================================================
-- CÃCH DÃ™NG ESP:
--   Script nÃ y expose hÃ m qua _G Ä‘á»ƒ nháº­n tÃ­n hiá»‡u:
--
--   _G.BotESPFire(targetPlayer)         -- Báº­t ESP + label "bot"
--   _G.BotESPFire(targetPlayer, true)   -- Táº¯t ESP
--
--   BotESP_Sender.lua sáº½ gá»i tá»± Ä‘á»™ng khi nháº¥n nÃºt.
--   KhÃ´ng cáº§n cháº¡y theo thá»© tá»± nÃ o.
-- =========================================================

local Players          = game:GetService("Players")
local TweenService     = game:GetService("TweenService")
local RunService       = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")

local player    = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- =========================================================
-- ESP SYSTEM
-- =========================================================
local activeESPs = {}

local function removeESP(targetPlayer)
    local uid = targetPlayer.UserId
    if activeESPs[uid] then
        local data = activeESPs[uid]
        if data.highlight and data.highlight.Parent then
            data.highlight:Destroy()
        end
        if data.billboard and data.billboard.Parent then
            data.billboard:Destroy()
        end
        if data.charConn then
            data.charConn:Disconnect()
        end
        activeESPs[uid] = nil
    end
end

local function applyESPToCharacter(targetPlayer, character)
    if not character then return end
    local uid = targetPlayer.UserId

    -- XÃ³a instance cÅ© náº¿u respawn
    if activeESPs[uid] then
        if activeESPs[uid].highlight and activeESPs[uid].highlight.Parent then
            activeESPs[uid].highlight:Destroy()
        end
        if activeESPs[uid].billboard and activeESPs[uid].billboard.Parent then
            activeESPs[uid].billboard:Destroy()
        end
    end

    -- ---- Highlight viá»n Ä‘á» ----
    local highlight = Instance.new("Highlight")
    highlight.Name                = "BotESP_Highlight"
    highlight.FillColor           = Color3.fromRGB(255, 50, 50)
    highlight.OutlineColor        = Color3.fromRGB(255, 80, 80)
    highlight.FillTransparency    = 0.6
    highlight.OutlineTransparency = 0
    highlight.DepthMode           = Enum.HighlightDepthMode.AlwaysOnTop
    highlight.Adornee             = character
    highlight.Parent              = character

    -- Nháº¥p nhÃ¡y viá»n
    task.spawn(function()
        while highlight and highlight.Parent do
            TweenService:Create(highlight,
                TweenInfo.new(0.7, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
                {OutlineTransparency = 0.7}):Play()
            task.wait(0.7)
            TweenService:Create(highlight,
                TweenInfo.new(0.7, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut),
                {OutlineTransparency = 0}):Play()
            task.wait(0.7)
        end
    end)

    -- ---- BillboardGui "ðŸ¤– bot" trÃªn Ä‘áº§u ----
    local head = character:FindFirstChild("Head") or character:FindFirstChildWhichIsA("BasePart")
    local billboard = nil
    if head then
        billboard = Instance.new("BillboardGui")
        billboard.Name         = "BotESP_Label"
        billboard.Size         = UDim2.new(0, 80, 0, 28)
        billboard.StudsOffset  = Vector3.new(0, 3.2, 0)
        billboard.AlwaysOnTop  = true
        billboard.ResetOnSpawn = false
        billboard.Adornee      = head
        billboard.Parent       = character

        local bg = Instance.new("Frame")
        bg.Size                   = UDim2.new(1, 0, 1, 0)
        bg.BackgroundColor3       = Color3.fromRGB(180, 30, 30)
        bg.BackgroundTransparency = 0.25
        bg.BorderSizePixel        = 0
        bg.Parent                 = billboard

        local c = Instance.new("UICorner")
        c.CornerRadius = UDim.new(0, 6)
        c.Parent = bg

        local s = Instance.new("UIStroke")
        s.Color        = Color3.fromRGB(255, 100, 100)
        s.Thickness    = 1.5
        s.Transparency = 0.1
        s.Parent       = bg

        local lbl = Instance.new("TextLabel")
        lbl.Size                   = UDim2.new(1, 0, 1, 0)
        lbl.BackgroundTransparency = 1
        lbl.Font                   = Enum.Font.GothamBold
        lbl.TextSize               = 13
        lbl.TextColor3             = Color3.fromRGB(255, 255, 255)
        lbl.Text                   = "ðŸ¤– bot"
        lbl.TextStrokeColor3       = Color3.fromRGB(0, 0, 0)
        lbl.TextStrokeTransparency = 0.3
        lbl.Parent                 = bg
    end

    if not activeESPs[uid] then activeESPs[uid] = {} end
    activeESPs[uid].highlight = highlight
    activeESPs[uid].billboard = billboard
end

local function enableESP(targetPlayer)
    local uid = targetPlayer.UserId
    local char = targetPlayer.Character
    if char then
        applyESPToCharacter(targetPlayer, char)
    end

    local conn = targetPlayer.CharacterAdded:Connect(function(newChar)
        task.wait(0.15)
        applyESPToCharacter(targetPlayer, newChar)
    end)

    if not activeESPs[uid] then activeESPs[uid] = {} end
    activeESPs[uid].charConn = conn
end

-- =========================================================
-- _G BRIDGE (khÃ´ng dÃ¹ng BindableEvent - trÃ¡nh lá»—i thá»© tá»±)
-- =========================================================
-- HÃ ng Ä‘á»£i log náº¿u UI chÆ°a sáºµn sÃ ng
local _pendingLogs = {}
local _realPushLog = nil  -- sáº½ Ä‘Æ°á»£c set sau khi UI khá»Ÿi xong

local function pushLogLine_safe(text)
    if _realPushLog then
        _realPushLog(text)
    else
        table.insert(_pendingLogs, text)
    end
end

_G.BotESPFire = function(targetPlayer, shouldRemove)
    if not targetPlayer then return end
    -- Há»— trá»£ truyá»n tÃªn string thay vÃ¬ object
    if type(targetPlayer) == "string" then
        targetPlayer = Players:FindFirstChild(targetPlayer)
        if not targetPlayer then return end
    end
    if not targetPlayer:IsA("Player") then return end

    if shouldRemove then
        removeESP(targetPlayer)
        pushLogLine_safe("ESP removed: " .. targetPlayer.Name)
    else
        enableESP(targetPlayer)
        pushLogLine_safe("ESP activated: " .. targetPlayer.Name)
    end
end

-- Dá»n khi player rá»i
Players.PlayerRemoving:Connect(function(plr)
    removeESP(plr)
end)

-- =========================================================
-- UI - Auto Moreira Method
-- =========================================================
local function getUserTitle()
    local name = "User"
    if player then
        if player.DisplayName and player.DisplayName ~= "" then
            name = player.DisplayName
        elseif player.Name and player.Name ~= "" then
            name = player.Name
        end
    end
    return name .. " ðŸŸ¢"
end

local OLD_NAME = "AutoMoreiraPanel_Full"
local old = playerGui:FindFirstChild(OLD_NAME)
if old then old:Destroy() end

local function addCorner(obj, radius)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, radius or 10)
    c.Parent = obj
    return c
end

local function addStroke(obj, thickness, color, transparency)
    local s = Instance.new("UIStroke")
    s.Thickness = thickness or 1
    s.Color = color or Color3.fromRGB(255, 255, 255)
    s.Transparency = transparency or 0.5
    s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    s.Parent = obj
    return s
end

local function addGradient(obj, c1, c2, rot)
    local g = Instance.new("UIGradient")
    g.Color = ColorSequence.new(c1, c2)
    g.Rotation = rot or 90
    g.Parent = obj
    return g
end

local function tween(obj, time, props, style, dir)
    local ti = TweenInfo.new(time, style or Enum.EasingStyle.Quad, dir or Enum.EasingDirection.Out)
    return TweenService:Create(obj, ti, props)
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = OLD_NAME
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 310, 0, 390)
frame.Position = UDim2.new(0.5, -155, 0.5, -195)
frame.BackgroundColor3 = Color3.fromRGB(10, 12, 18)
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui
addCorner(frame, 16)
addStroke(frame, 1.2, Color3.fromRGB(100, 115, 200), 0.3)
addGradient(frame, Color3.fromRGB(16, 20, 32), Color3.fromRGB(7, 9, 14), 90)

local frameScale = Instance.new("UIScale")
frameScale.Scale = 1
frameScale.Parent = frame

local uiVisible = true
local lastFramePos = frame.Position
local animToken = 0
local hiddenOffset = UDim2.new(0, 0, 0, 14)

local function setUIVisible(on)
    animToken += 1
    local myToken = animToken
    uiVisible = on
    if on then
        frame.Visible = true
        frame.Position = lastFramePos + hiddenOffset
        frameScale.Scale = 0.93
        tween(frameScale, 0.18, {Scale = 1}):Play()
        tween(frame, 0.18, {Position = lastFramePos}):Play()
    else
        lastFramePos = frame.Position
        local t1 = tween(frameScale, 0.18, {Scale = 0.93})
        local t2 = tween(frame, 0.18, {Position = lastFramePos + hiddenOffset})
        t1:Play(); t2:Play()
        t1.Completed:Wait()
        if animToken == myToken and not uiVisible then frame.Visible = false end
    end
end

-- Top bar
local topBar = Instance.new("Frame")
topBar.Size = UDim2.new(1, 0, 0, 52)
topBar.BackgroundColor3 = Color3.fromRGB(18, 24, 42)
topBar.BorderSizePixel = 0
topBar.Parent = frame
addCorner(topBar, 16)
addStroke(topBar, 1, Color3.fromRGB(130, 145, 220), 0.15)
addGradient(topBar, Color3.fromRGB(60, 88, 240), Color3.fromRGB(26, 36, 110), 0)

local topBarFix = Instance.new("Frame")
topBarFix.Size = UDim2.new(1, 0, 0, 16)
topBarFix.Position = UDim2.new(0, 0, 1, -16)
topBarFix.BackgroundColor3 = Color3.fromRGB(18, 24, 42)
topBarFix.BorderSizePixel = 0
topBarFix.Parent = topBar
addGradient(topBarFix, Color3.fromRGB(26, 36, 110), Color3.fromRGB(26, 36, 110), 90)

local logoCircle = Instance.new("Frame")
logoCircle.Size = UDim2.new(0, 34, 0, 34)
logoCircle.Position = UDim2.new(0, 10, 0.5, -17)
logoCircle.BackgroundColor3 = Color3.fromRGB(93, 118, 255)
logoCircle.BorderSizePixel = 0
logoCircle.Parent = topBar
addCorner(logoCircle, 10)
addStroke(logoCircle, 1, Color3.fromRGB(160, 180, 255), 0.25)
addGradient(logoCircle, Color3.fromRGB(120, 145, 255), Color3.fromRGB(70, 95, 220), 135)

local logoLabel = Instance.new("TextLabel")
logoLabel.Parent = logoCircle
logoLabel.BackgroundTransparency = 1
logoLabel.Size = UDim2.new(1, 0, 1, 0)
logoLabel.Font = Enum.Font.GothamBold
logoLabel.TextSize = 16
logoLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
logoLabel.Text = "M"

local titleLbl = Instance.new("TextLabel")
titleLbl.Parent = topBar
titleLbl.BackgroundTransparency = 1
titleLbl.Position = UDim2.new(0, 52, 0, 7)
titleLbl.Size = UDim2.new(1, -90, 0, 20)
titleLbl.Font = Enum.Font.GothamBold
titleLbl.TextSize = 15
titleLbl.TextXAlignment = Enum.TextXAlignment.Left
titleLbl.TextColor3 = Color3.fromRGB(255, 255, 255)
titleLbl.Text = "Fruit Stealing Method"

local titleSub = Instance.new("TextLabel")
titleSub.Parent = topBar
titleSub.BackgroundTransparency = 1
titleSub.Position = UDim2.new(0, 52, 0, 27)
titleSub.Size = UDim2.new(1, -90, 0, 16)
titleSub.Font = Enum.Font.Gotham
titleSub.TextSize = 11
titleSub.TextXAlignment = Enum.TextXAlignment.Left
titleSub.TextColor3 = Color3.fromRGB(180, 190, 230)
titleSub.Text = getUserTitle()

local closeBtn = Instance.new("TextButton")
closeBtn.Parent = topBar
closeBtn.Text = "âœ•"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 14
closeBtn.TextColor3 = Color3.fromRGB(200, 210, 255)
closeBtn.BackgroundColor3 = Color3.fromRGB(255, 80, 100)
closeBtn.BackgroundTransparency = 0.75
closeBtn.AutoButtonColor = false
closeBtn.Size = UDim2.new(0, 26, 0, 26)
closeBtn.Position = UDim2.new(1, -36, 0.5, -13)
addCorner(closeBtn, 8)
addStroke(closeBtn, 1, Color3.fromRGB(255, 120, 140), 0.4)
closeBtn.MouseEnter:Connect(function()
    tween(closeBtn, 0.15, {BackgroundTransparency = 0.2, TextColor3 = Color3.fromRGB(255,255,255)}):Play()
end)
closeBtn.MouseLeave:Connect(function()
    tween(closeBtn, 0.15, {BackgroundTransparency = 0.75, TextColor3 = Color3.fromRGB(200,210,255)}):Play()
end)
closeBtn.MouseButton1Click:Connect(function() setUIVisible(false) end)

-- Content area
local contentArea = Instance.new("Frame")
contentArea.Parent = frame
contentArea.BackgroundTransparency = 1
contentArea.Size = UDim2.new(1, -24, 1, -64)
contentArea.Position = UDim2.new(0, 12, 0, 58)

-- Status bar
local statusBar = Instance.new("Frame")
statusBar.Parent = contentArea
statusBar.Size = UDim2.new(1, 0, 0, 28)
statusBar.Position = UDim2.new(0, 0, 0, 0)
statusBar.BackgroundColor3 = Color3.fromRGB(10, 13, 22)
statusBar.BorderSizePixel = 0
addCorner(statusBar, 8)
addStroke(statusBar, 1, Color3.fromRGB(80, 95, 170), 0.4)

local statusDot = Instance.new("Frame")
statusDot.Parent = statusBar
statusDot.Size = UDim2.new(0, 8, 0, 8)
statusDot.Position = UDim2.new(0, 10, 0.5, -4)
statusDot.BackgroundColor3 = Color3.fromRGB(255, 80, 95)
addCorner(statusDot, 999)
addStroke(statusDot, 1, Color3.fromRGB(255, 150, 170), 0.2)

task.spawn(function()
    while statusDot.Parent do
        tween(statusDot, 0.6, {BackgroundTransparency = 0.5}, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut):Play()
        task.wait(0.6)
        tween(statusDot, 0.6, {BackgroundTransparency = 0}, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut):Play()
        task.wait(0.6)
    end
end)

local status = Instance.new("TextLabel")
status.Parent = statusBar
status.Size = UDim2.new(1, -26, 1, 0)
status.Position = UDim2.new(0, 24, 0, 0)
status.BackgroundTransparency = 1
status.Font = Enum.Font.GothamMedium
status.TextSize = 11
status.TextXAlignment = Enum.TextXAlignment.Left
status.TextColor3 = Color3.fromRGB(210, 218, 245)
status.Text = "Status: âœ… Ready"

-- Badges
local badgesRow = Instance.new("Frame")
badgesRow.Parent = contentArea
badgesRow.Size = UDim2.new(1, 0, 0, 22)
badgesRow.Position = UDim2.new(0, 0, 0, 34)
badgesRow.BackgroundTransparency = 1

local autoBlockBadge = Instance.new("Frame")
autoBlockBadge.Parent = badgesRow
autoBlockBadge.Size = UDim2.new(0.49, 0, 1, 0)
autoBlockBadge.BackgroundColor3 = Color3.fromRGB(10, 30, 18)
addCorner(autoBlockBadge, 7)
addStroke(autoBlockBadge, 1, Color3.fromRGB(70, 200, 120), 0.3)
addGradient(autoBlockBadge, Color3.fromRGB(18, 62, 36), Color3.fromRGB(8, 28, 18), 0)
local abt = Instance.new("TextLabel")
abt.Parent = autoBlockBadge
abt.BackgroundTransparency = 1
abt.Size = UDim2.new(1, -8, 1, 0)
abt.Position = UDim2.new(0, 6, 0, 0)
abt.Font = Enum.Font.GothamSemibold
abt.TextSize = 10
abt.TextXAlignment = Enum.TextXAlignment.Left
abt.TextColor3 = Color3.fromRGB(90, 255, 140)
abt.Text = "âœ“ Bypass Trade: ON"

local bypassBadge = Instance.new("Frame")
bypassBadge.Parent = badgesRow
bypassBadge.Size = UDim2.new(0.49, 0, 1, 0)
bypassBadge.Position = UDim2.new(0.51, 0, 0, 0)
bypassBadge.BackgroundColor3 = Color3.fromRGB(10, 22, 36)
addCorner(bypassBadge, 7)
addStroke(bypassBadge, 1, Color3.fromRGB(90, 160, 255), 0.3)
addGradient(bypassBadge, Color3.fromRGB(22, 52, 100), Color3.fromRGB(10, 22, 42), 0)
local bpt = Instance.new("TextLabel")
bpt.Parent = bypassBadge
bpt.BackgroundTransparency = 1
bpt.Size = UDim2.new(1, -8, 1, 0)
bpt.Position = UDim2.new(0, 6, 0, 0)
bpt.Font = Enum.Font.GothamSemibold
bpt.TextSize = 10
bpt.TextXAlignment = Enum.TextXAlignment.Left
bpt.TextColor3 = Color3.fromRGB(130, 190, 255)
bpt.Text = "âœ“ Anti Ban: ON"

-- Log panel
local logCard = Instance.new("Frame")
logCard.Parent = contentArea
logCard.Size = UDim2.new(1, 0, 0, 180)
logCard.Position = UDim2.new(0, 0, 0, 62)
logCard.BackgroundColor3 = Color3.fromRGB(8, 10, 16)
logCard.BorderSizePixel = 0
addCorner(logCard, 10)
addStroke(logCard, 1, Color3.fromRGB(80, 95, 165), 0.35)

local logHeader = Instance.new("Frame")
logHeader.Parent = logCard
logHeader.Size = UDim2.new(1, -16, 0, 26)
logHeader.Position = UDim2.new(0, 8, 0, 4)
logHeader.BackgroundTransparency = 1

local logTitleLbl = Instance.new("TextLabel")
logTitleLbl.Parent = logHeader
logTitleLbl.BackgroundTransparency = 1
logTitleLbl.Size = UDim2.new(1, -80, 1, 0)
logTitleLbl.Font = Enum.Font.GothamSemibold
logTitleLbl.TextSize = 11
logTitleLbl.TextXAlignment = Enum.TextXAlignment.Left
logTitleLbl.TextColor3 = Color3.fromRGB(175, 185, 225)
logTitleLbl.Text = "ðŸ“‹ Logs"

local clearBtn = Instance.new("TextButton")
clearBtn.Parent = logHeader
clearBtn.Size = UDim2.new(0, 54, 0, 18)
clearBtn.Position = UDim2.new(1, -56, 0.5, -9)
clearBtn.Text = "Clear"
clearBtn.Font = Enum.Font.GothamBold
clearBtn.TextSize = 10
clearBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
clearBtn.BackgroundColor3 = Color3.fromRGB(185, 60, 75)
clearBtn.AutoButtonColor = false
clearBtn.Visible = false
addCorner(clearBtn, 999)
addStroke(clearBtn, 1, Color3.fromRGB(255, 110, 130), 0.3)
clearBtn.MouseEnter:Connect(function()
    if not clearBtn.Visible then return end
    tween(clearBtn, 0.12, {BackgroundColor3 = Color3.fromRGB(210, 80, 95)}):Play()
end)
clearBtn.MouseLeave:Connect(function()
    if not clearBtn.Visible then return end
    tween(clearBtn, 0.12, {BackgroundColor3 = Color3.fromRGB(185, 60, 75)}):Play()
end)

local logDivider = Instance.new("Frame")
logDivider.Parent = logCard
logDivider.Size = UDim2.new(1, -16, 0, 1)
logDivider.Position = UDim2.new(0, 8, 0, 32)
logDivider.BackgroundColor3 = Color3.fromRGB(80, 95, 160)
logDivider.BackgroundTransparency = 0.6
logDivider.BorderSizePixel = 0

local logScroll = Instance.new("ScrollingFrame")
logScroll.Parent = logCard
logScroll.Size = UDim2.new(1, -16, 1, -40)
logScroll.Position = UDim2.new(0, 8, 0, 36)
logScroll.BackgroundTransparency = 1
logScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
logScroll.ScrollBarThickness = 2
logScroll.ScrollBarImageColor3 = Color3.fromRGB(120, 140, 220)
logScroll.BorderSizePixel = 0

local logsContainer = Instance.new("Frame")
logsContainer.Parent = logScroll
logsContainer.Size = UDim2.new(1, 0, 0, 0)
logsContainer.BackgroundTransparency = 1

local uiList = Instance.new("UIListLayout")
uiList.Parent = logsContainer
uiList.SortOrder = Enum.SortOrder.LayoutOrder
uiList.Padding = UDim.new(0, 1)

uiList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    local h = uiList.AbsoluteContentSize.Y
    logsContainer.Size = UDim2.new(1, 0, 0, h)
    logScroll.CanvasSize = UDim2.new(0, 0, 0, h)
    logScroll.CanvasPosition = Vector2.new(0, math.max(0, h - logScroll.AbsoluteSize.Y))
end)

local logCount = 0
local logSequence = 0

clearBtn.MouseButton1Click:Connect(function()
    for _, child in ipairs(logsContainer:GetChildren()) do
        if child:IsA("Frame") and child.Name == "LogLine" then child:Destroy() end
    end
    logsContainer.Size = UDim2.new(1, 0, 0, 0)
    logScroll.CanvasSize = UDim2.new(0, 0, 0, 0)
    clearBtn.Visible = false
    logCount = 0
    logSequence = 0
end)

-- Progress + Start
local bottomArea = Instance.new("Frame")
bottomArea.Parent = contentArea
bottomArea.Size = UDim2.new(1, 0, 0, 82)
bottomArea.Position = UDim2.new(0, 0, 0, 248)
bottomArea.BackgroundTransparency = 1

local processCard = Instance.new("Frame")
processCard.Parent = bottomArea
processCard.Size = UDim2.new(1, 0, 0, 10)
processCard.BackgroundColor3 = Color3.fromRGB(8, 11, 20)
addCorner(processCard, 999)
addStroke(processCard, 1, Color3.fromRGB(70, 88, 165), 0.45)

local progressBack = Instance.new("Frame")
progressBack.Parent = processCard
progressBack.Size = UDim2.new(1, -4, 1, -4)
progressBack.Position = UDim2.new(0, 2, 0, 2)
progressBack.BackgroundColor3 = Color3.fromRGB(20, 24, 38)
progressBack.BackgroundTransparency = 1
addCorner(progressBack, 999)

local progressFill = Instance.new("Frame")
progressFill.Parent = progressBack
progressFill.Size = UDim2.new(0, 0, 1, 0)
progressFill.BackgroundColor3 = Color3.fromRGB(93, 118, 255)
progressFill.BackgroundTransparency = 1
addCorner(progressFill, 999)
addGradient(progressFill, Color3.fromRGB(150, 172, 255), Color3.fromRGB(75, 100, 240), 0)

local versionTag = Instance.new("TextLabel")
versionTag.Parent = bottomArea
versionTag.BackgroundTransparency = 1
versionTag.Size = UDim2.new(1, 0, 0, 14)
versionTag.Position = UDim2.new(0, 0, 0, 14)
versionTag.Font = Enum.Font.Gotham
versionTag.TextSize = 9
versionTag.TextColor3 = Color3.fromRGB(100, 110, 160)
versionTag.Text = "v8.1 â€¢ Fruit Stealing Method + ESP"

local startBtn = Instance.new("TextButton")
startBtn.Parent = bottomArea
startBtn.Text = "â–¶  Start Stealing"
startBtn.Font = Enum.Font.GothamBold
startBtn.TextSize = 14
startBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
startBtn.BackgroundColor3 = Color3.fromRGB(88, 115, 250)
startBtn.AutoButtonColor = false
startBtn.Size = UDim2.new(1, 0, 0, 40)
startBtn.Position = UDim2.new(0, 0, 0, 32)
addCorner(startBtn, 12)
addStroke(startBtn, 1.2, Color3.fromRGB(145, 168, 255), 0.12)
addGradient(startBtn, Color3.fromRGB(125, 148, 255), Color3.fromRGB(75, 102, 230), 135)
startBtn.MouseEnter:Connect(function()
    if not startBtn.Visible then return end
    tween(startBtn, 0.15, {BackgroundColor3 = Color3.fromRGB(108, 132, 255)}):Play()
end)
startBtn.MouseLeave:Connect(function()
    if not startBtn.Visible then return end
    tween(startBtn, 0.15, {BackgroundColor3 = Color3.fromRGB(88, 115, 250)}):Play()
end)

-- Filter overlay
local function showFilter(onDone)
    local overlay = Instance.new("Frame")
    overlay.Name = "FilterOverlay"
    overlay.Parent = screenGui
    overlay.Size = UDim2.new(1, 0, 1, 0)
    overlay.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    overlay.BackgroundTransparency = 1
    overlay.ZIndex = 50

    local panel = Instance.new("Frame")
    panel.Size = UDim2.new(0, 250, 0, 210)
    panel.Position = UDim2.new(0.5, -125, 0.5, -105)
    panel.BackgroundColor3 = Color3.fromRGB(14, 16, 26)
    panel.BackgroundTransparency = 1
    panel.ZIndex = 51
    panel.Parent = overlay
    addCorner(panel, 14)
    addStroke(panel, 1.2, Color3.fromRGB(100, 125, 215), 0.25)
    addGradient(panel, Color3.fromRGB(18, 22, 36), Color3.fromRGB(10, 12, 20), 90)

    local panelTitle = Instance.new("TextLabel")
    panelTitle.Parent = panel; panelTitle.BackgroundTransparency = 1
    panelTitle.Position = UDim2.new(0,14,0,12); panelTitle.Size = UDim2.new(1,-28,0,22)
    panelTitle.Font = Enum.Font.GothamBold; panelTitle.TextSize = 16
    panelTitle.TextXAlignment = Enum.TextXAlignment.Left
    panelTitle.TextColor3 = Color3.fromRGB(235,240,255); panelTitle.ZIndex = 52
    panelTitle.Text = "ðŸŽšï¸ Select Filter"

    local panelDiv = Instance.new("Frame")
    panelDiv.Parent = panel; panelDiv.Size = UDim2.new(1,-28,0,1)
    panelDiv.Position = UDim2.new(0,14,0,38)
    panelDiv.BackgroundColor3 = Color3.fromRGB(100,120,210)
    panelDiv.BackgroundTransparency = 0.6; panelDiv.BorderSizePixel = 0; panelDiv.ZIndex = 52

    local note = Instance.new("TextLabel")
    note.Parent = panel; note.BackgroundTransparency = 1
    note.Position = UDim2.new(0,14,0,44); note.Size = UDim2.new(1,-28,0,36)
    note.Font = Enum.Font.Gotham; note.TextSize = 10; note.TextWrapped = true
    note.TextXAlignment = Enum.TextXAlignment.Left; note.TextYAlignment = Enum.TextYAlignment.Top
    note.TextColor3 = Color3.fromRGB(180,188,220); note.ZIndex = 52
    note.Text = "Higher m+ requires a better base. High values = longer wait for players to join."

    local bf = Instance.new("Frame")
    bf.Parent = panel; bf.BackgroundTransparency = 1
    bf.Position = UDim2.new(0,14,0,84); bf.Size = UDim2.new(1,-28,0,114); bf.ZIndex = 52

    local grid = Instance.new("UIGridLayout")
    grid.Parent = bf; grid.CellPadding = UDim2.new(0,6,0,6)
    grid.CellSize = UDim2.new(0.5,-3,0,24)
    grid.FillDirection = Enum.FillDirection.Horizontal
    grid.SortOrder = Enum.SortOrder.LayoutOrder

    for _, txt in ipairs({"Dough","T-Rex","Yeti","Control","Tiger","Kitsune","Dragon(West)","Dragon(East)"}) do
        local btn = Instance.new("TextButton")
        btn.Parent = bf; btn.BackgroundColor3 = Color3.fromRGB(55,82,210)
        btn.BorderSizePixel = 0; btn.AutoButtonColor = false
        btn.Font = Enum.Font.GothamSemibold; btn.TextSize = 12
        btn.TextColor3 = Color3.fromRGB(240,245,255); btn.Text = txt; btn.ZIndex = 53
        addCorner(btn, 8); addStroke(btn, 1, Color3.fromRGB(120,148,255), 0.35)
        addGradient(btn, Color3.fromRGB(80,108,235), Color3.fromRGB(50,75,195), 135)
        btn.MouseEnter:Connect(function() tween(btn, 0.15, {BackgroundColor3 = Color3.fromRGB(78,105,230)}):Play() end)
        btn.MouseLeave:Connect(function() tween(btn, 0.15, {BackgroundColor3 = Color3.fromRGB(55,82,210)}):Play() end)
        btn.MouseButton1Click:Connect(function()
            local t1 = tween(overlay, 0.22, {BackgroundTransparency = 1})
            local t2 = tween(panel, 0.22, {BackgroundTransparency = 1})
            t1:Play(); t2:Play(); t2.Completed:Wait()
            overlay:Destroy()
            if onDone then onDone(txt) end
        end)
    end

    tween(overlay, 0.22, {BackgroundTransparency = 0.4}):Play()
    tween(panel, 0.22, {BackgroundTransparency = 0}):Play()
end

-- Log functions
local function getTimePrefix()
    local t = os.date("*t")
    return string.format("[%02d:%02d:%02d] ", t.hour, t.min, t.sec)
end

local function chooseIcon(text)
    if string.find(text, "Successfully sent") then return "âœ…"
    elseif string.find(text, "Failed to sent") then return "âŒ"
    elseif string.find(text, "Please wait a moment") then return "â±ï¸"
    elseif string.find(text, "Finished") then return "ðŸŽ‰"
    elseif string.find(text, "joined the server") then return "ðŸ‘¤"
    elseif string.find(text, "Filter applied") then return "ðŸŽšï¸"
    elseif string.find(text, "Starting auto%-scan") then return "ðŸ”"
    elseif string.find(text, "Starting scan") then return "ðŸ“¡"
    elseif string.find(text, "Scanned") then return "ðŸ§ "
    elseif string.find(text, "sending webhook") then return "ðŸŒ"
    elseif string.find(text, "Waiting for players") then return "â³"
    elseif string.find(text, "ESP") then return "ðŸŽ¯"
    end
    return "â€¢"
end

local function pushLogLine(text, iconOverride)
    local row = Instance.new("Frame")
    row.Name = "LogLine"
    local rowHeight = 16
    if string.find(text, "Finished") then rowHeight = 24 end
    row.BackgroundTransparency = 1
    row.Size = UDim2.new(1, 0, 0, rowHeight)
    row.Parent = logsContainer
    logSequence += 1
    row.LayoutOrder = logSequence

    local icon = iconOverride or chooseIcon(text)
    local textLabel = Instance.new("TextLabel")
    textLabel.BackgroundTransparency = 1
    textLabel.Size = UDim2.new(1, -4, 1, 0)
    textLabel.Position = UDim2.new(0, 2, 0, 0)
    textLabel.Font = Enum.Font.Code
    textLabel.TextSize = 11
    textLabel.TextXAlignment = Enum.TextXAlignment.Left
    textLabel.Text = getTimePrefix() .. icon .. " " .. text
    textLabel.TextColor3 = Color3.fromRGB(215, 225, 255)
    if string.find(text, "Finished") then
        textLabel.TextWrapped = true; textLabel.TextYAlignment = Enum.TextYAlignment.Top
    else
        textLabel.TextWrapped = false; textLabel.TextYAlignment = Enum.TextYAlignment.Center
    end
    textLabel.Parent = row

    if string.find(text, "Successfully sent") then textLabel.TextColor3 = Color3.fromRGB(100,255,145)
    elseif string.find(text, "Failed to sent") then textLabel.TextColor3 = Color3.fromRGB(255,115,130)
    elseif string.find(text, "Starting auto%-scan") then textLabel.TextColor3 = Color3.fromRGB(165,222,255)
    elseif string.find(text, "Starting scan") then textLabel.TextColor3 = Color3.fromRGB(145,200,255)
    elseif string.find(text, "Scanned") then textLabel.TextColor3 = Color3.fromRGB(205,185,255)
    elseif string.find(text, "sending webhook") then textLabel.TextColor3 = Color3.fromRGB(175,238,215)
    elseif string.find(text, "Please wait a moment") then textLabel.TextColor3 = Color3.fromRGB(145,185,255)
    elseif string.find(text, "Waiting") then textLabel.TextColor3 = Color3.fromRGB(100,172,255)
    elseif string.find(text, "Finished") then textLabel.TextColor3 = Color3.fromRGB(175,255,195)
    elseif string.find(text, "joined the server") then textLabel.TextColor3 = Color3.fromRGB(255,222,115)
    elseif string.find(text, "ESP") then textLabel.TextColor3 = Color3.fromRGB(255,150,150)
    end

    clearBtn.Visible = true
    logCount += 1
    if logCount > 300 then
        local oldest = nil
        for _, c in ipairs(logsContainer:GetChildren()) do
            if c:IsA("Frame") and c.Name == "LogLine" then
                if not oldest or c.LayoutOrder < oldest.LayoutOrder then oldest = c end
            end
        end
        if oldest then oldest:Destroy(); logCount -= 1 end
    end
    return textLabel
end

-- Káº¿t ná»‘i hÃ m log tháº­t vÃ o bridge
_realPushLog = pushLogLine
-- Flush log cÃ²n chá»
for _, msg in ipairs(_pendingLogs) do pushLogLine(msg) end
_pendingLogs = {}

local function animateDots(label, duration)
    if not label then return end
    local original = label.Text or ""
    local pfx, cont = "", original
    local bp = string.find(original, "] ")
    if bp then pfx = string.sub(original,1,bp+1); cont = string.sub(original,bp+2) end
    local base = cont:gsub("%.+$","")
    local startTime = tick(); local dc = 0
    while tick()-startTime < duration and label.Parent do
        dc = (dc%3)+1; label.Text = pfx..base..string.rep(".",dc); task.wait(0.35)
    end
    if label.Parent then label.Text = pfx..base.."..." end
end

local function randomOddEven(a,b)
    local n = math.random(a,b)
    if math.random(1,100)<=70 then if n%2==0 then n=n+1 end
    else if n%2~=0 then n=n+1 end end
    return n
end

local function randomOddInRange(a,b)
    local n = math.random(a,b)
    if n%2==0 then n=(n+1<=b) and n+1 or n-1 end
    return n
end

local function getScannedCount(f)
    if f=="200m+" then return randomOddInRange(1000,4000)
    elseif f=="100m+" then return randomOddInRange(1000,5000)
    elseif f=="75m+"  then return randomOddInRange(1000,6000)
    elseif f=="50m+"  then return randomOddInRange(1000,7000)
    elseif f=="40m+"  then return randomOddInRange(1000,7500)
    elseif f=="30m+"  then return 8000
    elseif f=="20m+"  then return 8500
    elseif f=="10m+"  then return randomOddInRange(1000,15000)
    else return randomOddInRange(1000,10000) end
end

local function pickResults() return randomOddEven(700,1000), randomOddEven(50,300) end

local running = false
local waitingForPlayers = false
local brainrotActive = false

Players.PlayerAdded:Connect(function(plr)
    if waitingForPlayers and plr ~= player then
        pushLogLine("The player joined the serverðŸ“Ž")
        status.Text = "let's get fruit"
        brainrotActive = true
    end
end)

Players.PlayerRemoving:Connect(function(plr)
    if brainrotActive and plr ~= player then
        status.Text = "Status: âœ… Ready"
        brainrotActive = false
    end
    removeESP(plr)
end)

local function startProcess(selectedFilter)
    if running then return end
    running = true; waitingForPlayers = false; brainrotActive = false
    if selectedFilter then pushLogLine("Filter applied: "..selectedFilter) end
    status.Text = "Status: ðŸŸ¡ Sending..."
    tween(statusDot, 0.2, {BackgroundColor3 = Color3.fromRGB(255,200,60)}):Play()
    local ht = tween(startBtn, 0.3, {BackgroundTransparency=1, TextTransparency=1})
    ht:Play(); ht.Completed:Wait(); startBtn.Visible = false

    animateDots(pushLogLine("Starting auto-scan..."), 2)
    animateDots(pushLogLine("Starting scan..."), 3)
    animateDots(pushLogLine("Scanned "..getScannedCount(selectedFilter).." objects"), 2)
    animateDots(pushLogLine("sending webhook..."), 2)

    progressBack.Visible=true; progressFill.Visible=true
    tween(progressBack,0.25,{BackgroundTransparency=0}):Play()
    tween(progressFill,0.25,{BackgroundTransparency=0}):Play()
    pushLogLine("Waiting for Fruit Stealing Methodâš™ï¸")

    local infoCount = math.random(10,35)
    local successCount, failCount = pickResults()
    local totalLogs = infoCount+successCount+failCount
    local delayPerLog = 15/totalLogs
    local index = 0

    for i=1,infoCount do
        index+=1; pushLogLine("Please wait a moment for it to be sent to the server")
        tween(progressFill,0.15,{Size=UDim2.new(index/totalLogs,0,1,0)}):Play()
        task.wait(delayPerLog)
    end

    local arr={}
    for i=1,successCount do table.insert(arr,"S") end
    for i=1,failCount do table.insert(arr,"F") end
    for i=#arr,2,-1 do local j=math.random(1,i); arr[i],arr[j]=arr[j],arr[i] end

    for _,v in ipairs(arr) do
        index+=1
        pushLogLine(v=="S" and "Successfully sent to a server" or "Failed to sent to a server")
        tween(progressFill,0.12,{Size=UDim2.new(index/totalLogs,0,1,0)}):Play()
        task.wait(delayPerLog)
    end

    pushLogLine(("Finished. Success(%d)  Fail(%d)"):format(successCount,failCount))
    status.Text="Status: ðŸŸ¢ Finished"
    tween(statusDot,0.3,{BackgroundColor3=Color3.fromRGB(80,240,130)}):Play()
    task.wait(2)
    pushLogLine("Waiting for players to join")
    waitingForPlayers = true

    tween(progressBack,0.35,{BackgroundTransparency=1}):Play()
    local pfOut = tween(progressFill,0.35,{BackgroundTransparency=1})
    pfOut:Play(); pfOut.Completed:Wait()
    progressBack.Visible=false; progressFill.Size=UDim2.new(0,0,1,0)

    startBtn.Visible=true; startBtn.BackgroundTransparency=1; startBtn.TextTransparency=1
    tween(startBtn,0.35,{BackgroundTransparency=0,TextTransparency=0}):Play()
    if not brainrotActive then
        status.Text="Status: âœ… Ready"
        tween(statusDot,0.3,{BackgroundColor3=Color3.fromRGB(255,80,95)}):Play()
    end
    running=false
end

startBtn.MouseButton1Click:Connect(function()
    if running then return end
    showFilter(function(sel) startProcess(sel) end)
end)

frame.Position = frame.Position + UDim2.new(0,0,0,20); frameScale.Scale=0.9
tween(frame,0.25,{Position=frame.Position-UDim2.new(0,0,0,20)},Enum.EasingStyle.Back,Enum.EasingDirection.Out):Play()
tween(frameScale,0.25,{Scale=1},Enum.EasingStyle.Back,Enum.EasingDirection.Out):Play()

print("[FruitMethod ESP v8.1] Loaded! _G.BotESPFire sáºµn sÃ ng.")
