local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

local Player = Players.LocalPlayer
local PlayerGui = Player:WaitForChild("PlayerGui")

-- Tạo GUI với thiết kế hiện đại
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "BrainrotAdderGui"
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.Parent = PlayerGui

-- Main container với background mờ nhẹ
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 320, 0, 220)
mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
mainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
mainFrame.BackgroundTransparency = 0.2
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui

-- Rounded corners
local corner = Instance.new("UICorner")
corner.CornerRadius = UDim.new(0, 15)
corner.Parent = mainFrame

-- Header với accent color
local header = Instance.new("Frame")
header.Size = UDim2.new(1, 0, 0, 50)
header.BackgroundColor3 = Color3.fromRGB(120, 80, 220)
header.BackgroundTransparency = 0.1
header.BorderSizePixel = 0
header.Parent = mainFrame

local headerCorner = Instance.new("UICorner")
headerCorner.CornerRadius = UDim.new(0, 15)
headerCorner.Parent = header

-- Title container - điều chỉnh để title sát trái
local titleContainer = Instance.new("Frame")
titleContainer.Size = UDim2.new(1, 0, 1, 0)
titleContainer.BackgroundTransparency = 1
titleContainer.Parent = header

-- Title "ADD BRAINROT" - sát bên trái
local title = Instance.new("TextLabel")
title.Size = UDim2.new(0.7, 0, 1, 0)
title.Position = UDim2.new(0, 15, 0, 0)  -- Sát trái với padding 15
title.BackgroundTransparency = 1
title.Text = "ADD BRAINROT"
title.TextColor3 = Color3.fromRGB(255, 255, 255)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left
title.TextYAlignment = Enum.TextYAlignment.Center
title.Parent = titleContainer

-- Close button với dấu X rõ ràng
local closeButton = Instance.new("TextButton")
closeButton.Size = UDim2.new(0, 32, 0, 32)
closeButton.Position = UDim2.new(1, -37, 0.5, 0)
closeButton.AnchorPoint = Vector2.new(0, 0.5)
closeButton.BackgroundColor3 = Color3.fromRGB(220, 80, 80)
closeButton.BackgroundTransparency = 0.2
closeButton.Text = "X"
closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
closeButton.Font = Enum.Font.GothamBold
closeButton.TextSize = 16
closeButton.AutoButtonColor = false
closeButton.Parent = titleContainer

local closeButtonCorner = Instance.new("UICorner")
closeButtonCorner.CornerRadius = UDim.new(0, 8)
closeButtonCorner.Parent = closeButton

-- Content container
local contentContainer = Instance.new("Frame")
contentContainer.Size = UDim2.new(1, 0, 1, -60)
contentContainer.Position = UDim2.new(0, 0, 0, 60)
contentContainer.BackgroundTransparency = 1
contentContainer.Parent = mainFrame

-- Input container với spacing
local inputContainer = Instance.new("Frame")
inputContainer.Size = UDim2.new(1, -30, 1, -20)
inputContainer.Position = UDim2.new(0, 15, 0, 15)
inputContainer.BackgroundTransparency = 1
inputContainer.Parent = contentContainer

-- TextBox modern design
local textBoxOuter = Instance.new("Frame")
textBoxOuter.Size = UDim2.new(1, 0, 0, 50)
textBoxOuter.BackgroundColor3 = Color3.fromRGB(40, 40, 50)
textBoxOuter.BackgroundTransparency = 0.2
textBoxOuter.Parent = inputContainer

local textBoxCorner = Instance.new("UICorner")
textBoxCorner.CornerRadius = UDim.new(0, 10)
textBoxCorner.Parent = textBoxOuter

local textBox = Instance.new("TextBox")
textBox.Size = UDim2.new(1, -20, 1, 0)
textBox.Position = UDim2.new(0, 10, 0, 0)
textBox.PlaceholderText = "Enter brainrot name here"
textBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 170)
textBox.BackgroundTransparency = 1
textBox.TextColor3 = Color3.fromRGB(255, 255, 255)
textBox.ClearTextOnFocus = false
textBox.Font = Enum.Font.Gotham
textBox.TextSize = 15
textBox.TextXAlignment = Enum.TextXAlignment.Left
textBox.TextYAlignment = Enum.TextYAlignment.Center
textBox.Parent = textBoxOuter

-- Placeholder label
local placeholderLabel = Instance.new("TextLabel")
placeholderLabel.Text = "BRAINROT NAME"
placeholderLabel.TextColor3 = Color3.fromRGB(150, 150, 170)
placeholderLabel.BackgroundTransparency = 1
placeholderLabel.Font = Enum.Font.GothamSemibold
placeholderLabel.TextSize = 11
placeholderLabel.Position = UDim2.new(0, 12, 0, -18)
placeholderLabel.Size = UDim2.new(0.5, 0, 0, 16)
placeholderLabel.TextXAlignment = Enum.TextXAlignment.Left
placeholderLabel.Visible = (textBox.Text == "")
placeholderLabel.Parent = textBoxOuter

-- Button với spacing
local button = Instance.new("TextButton")
button.Size = UDim2.new(1, 0, 0, 50)
button.Position = UDim2.new(0, 0, 0, 70)
button.Text = "SPAWN"
button.BackgroundColor3 = Color3.fromRGB(120, 80, 220)
button.BackgroundTransparency = 0.1
button.TextColor3 = Color3.fromRGB(255, 255, 255)
button.Font = Enum.Font.GothamBold
button.TextSize = 16
button.AutoButtonColor = false
button.Parent = inputContainer

local buttonCorner = Instance.new("UICorner")
buttonCorner.CornerRadius = UDim.new(0, 10)
buttonCorner.Parent = button

-- DRAG FUNCTIONALITY - Có thể kéo từ HEADER
local dragging = false
local dragStart
local startPos

local function updateDrag(input)
	local delta = input.Position - dragStart
	mainFrame.Position = UDim2.new(
		startPos.X.Scale,
		startPos.X.Offset + delta.X,
		startPos.Y.Scale,
		startPos.Y.Offset + delta.Y
	)
end

-- Cho phép kéo từ HEADER (không phải từ toàn bộ mainFrame)
header.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
		dragging = true
		dragStart = input.Position
		startPos = mainFrame.Position
		
		local connection
		connection = input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
				if connection then
					connection:Disconnect()
				end
			end
		end)
	end
end)

UserInputService.InputChanged:Connect(function(input)
	if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
		updateDrag(input)
	end
end)

-- Hiệu ứng textbox
textBox:GetPropertyChangedSignal("Text"):Connect(function()
	placeholderLabel.Visible = (textBox.Text == "")
end)

textBox.Focused:Connect(function()
	local tween = TweenService:Create(textBoxOuter, TweenInfo.new(0.2), {
		BackgroundColor3 = Color3.fromRGB(60, 60, 75),
		BackgroundTransparency = 0.1
	})
	tween:Play()
	
	placeholderLabel.TextColor3 = Color3.fromRGB(140, 100, 255)
end)

textBox.FocusLost:Connect(function()
	local tween = TweenService:Create(textBoxOuter, TweenInfo.new(0.3), {
		BackgroundColor3 = Color3.fromRGB(40, 40, 50),
		BackgroundTransparency = 0.2
	})
	tween:Play()
	
	placeholderLabel.TextColor3 = Color3.fromRGB(150, 150, 170)
end)

-- Hiệu ứng hover cho button
button.MouseEnter:Connect(function()
	local tween = TweenService:Create(button, TweenInfo.new(0.2), {
		BackgroundColor3 = Color3.fromRGB(130, 90, 230),
		BackgroundTransparency = 0.05
	})
	tween:Play()
end)

button.MouseLeave:Connect(function()
	local tween = TweenService:Create(button, TweenInfo.new(0.2), {
		BackgroundColor3 = Color3.fromRGB(120, 80, 220),
		BackgroundTransparency = 0.1
	})
	tween:Play()
end)

-- Hiệu ứng click cho button
button.MouseButton1Down:Connect(function()
	local tween = TweenService:Create(button, TweenInfo.new(0.1), {
		BackgroundColor3 = Color3.fromRGB(100, 60, 200),
		BackgroundTransparency = 0
	})
	tween:Play()
end)

button.MouseButton1Up:Connect(function()
	local tween = TweenService:Create(button, TweenInfo.new(0.15), {
		BackgroundColor3 = Color3.fromRGB(120, 80, 220),
		BackgroundTransparency = 0.1
	})
	tween:Play()
end)

-- Hiệu ứng cho close button
closeButton.MouseEnter:Connect(function()
	local tween = TweenService:Create(closeButton, TweenInfo.new(0.2), {
		BackgroundColor3 = Color3.fromRGB(240, 100, 100),
		BackgroundTransparency = 0,
		Size = UDim2.new(0, 34, 0, 34)
	})
	tween:Play()
end)

closeButton.MouseLeave:Connect(function()
	local tween = TweenService:Create(closeButton, TweenInfo.new(0.2), {
		BackgroundColor3 = Color3.fromRGB(220, 80, 80),
		BackgroundTransparency = 0.2,
		Size = UDim2.new(0, 32, 0, 32)
	})
	tween:Play()
end)

closeButton.MouseButton1Down:Connect(function()
	local tween = TweenService:Create(closeButton, TweenInfo.new(0.1), {
		Size = UDim2.new(0, 30, 0, 30),
		BackgroundColor3 = Color3.fromRGB(200, 60, 60)
	})
	tween:Play()
end)

closeButton.MouseButton1Up:Connect(function()
	local tween = TweenService:Create(closeButton, TweenInfo.new(0.1), {
		Size = UDim2.new(0, 32, 0, 32),
		BackgroundColor3 = Color3.fromRGB(220, 80, 80)
	})
	tween:Play()
end)

closeButton.Activated:Connect(function()
	-- Animation đóng
	local destroyTween = TweenService:Create(mainFrame, TweenInfo.new(0.2), {
		Size = UDim2.new(0, 320, 0, 0),
		BackgroundTransparency = 1
	})
	destroyTween:Play()
	
	destroyTween.Completed:Wait()
	screenGui:Destroy()
end)

-- Spawn functionality
button.Activated:Connect(function()
	local name = textBox.Text
	if name ~= "" and name ~= nil then
		-- Hiệu ứng loading
		button.Text = "SPAWNING..."
		
		local originalColor = button.BackgroundColor3
		local tween = TweenService:Create(button, TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.InOut, -1, true), {
			BackgroundColor3 = Color3.fromRGB(80, 50, 180)
		})
		tween:Play()
		
		pcall(function()
			ReplicatedStorage:WaitForChild("Packages")
				:WaitForChild("Net")
				:WaitForChild("RF/AdminService/SpawnBrainrotInBase")
				:InvokeServer(name, "", "")
		end)
		
		-- Reset button
		tween:Cancel()
		button.BackgroundColor3 = originalColor
		button.Text = "SPAWN"
		
		-- Reset textbox với hiệu ứng
		local textTween = TweenService:Create(textBox, TweenInfo.new(0.3), {
			TextTransparency = 1
		})
		textTween:Play()
		
		textTween.Completed:Wait()
		textBox.Text = ""
		
		local textTween2 = TweenService:Create(textBox, TweenInfo.new(0.3), {
			TextTransparency = 0
		})
		textTween2:Play()
	end
end)

-- Hiệu ứng mở GUI
mainFrame.Size = UDim2.new(0, 0, 0, 220)
mainFrame.BackgroundTransparency = 1
local openTween = TweenService:Create(mainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
	Size = UDim2.new(0, 320, 0, 220),
	BackgroundTransparency = 0.2
})
openTween:Play()
