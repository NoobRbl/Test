local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")

local player = Players.LocalPlayer
local PlayerGui = player:WaitForChild("PlayerGui")

-- X√≥a GUI c≈©
local old = PlayerGui:FindFirstChild("CrashXMatrix")
if old then old:Destroy() end

--== SCREEN GUI ==--
local gui = Instance.new("ScreenGui")
gui.Name = "CrashXMatrix"
gui.ResetOnSpawn = false
gui.Parent = PlayerGui

--== FLOAT BUTTON ==--
local toggleBtn = Instance.new("ImageButton")
toggleBtn.Size = UDim2.new(0,55,0,55)
toggleBtn.Position = UDim2.new(0.06,0,0.78,0)
toggleBtn.BackgroundTransparency = 1
toggleBtn.Image = "rbxassetid://125920679907673"
toggleBtn.Parent = gui

local toggleCorner = Instance.new("UICorner", toggleBtn)
toggleCorner.CornerRadius = UDim.new(.5, 0)

toggleBtn.MouseEnter:Connect(function()
    TweenService:Create(toggleBtn, TweenInfo.new(.15), {ImageTransparency = .2}):Play()
end)
toggleBtn.MouseLeave:Connect(function()
    TweenService:Create(toggleBtn, TweenInfo.new(.15), {ImageTransparency = 0}):Play()
end)

-- Dragging
local dragging, dragStart, startPos
toggleBtn.InputBegan:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton1 then
        dragging = true
        dragStart = i.Position
        startPos = toggleBtn.Position
    end
end)

UserInputService.InputChanged:Connect(function(i)
    if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
        local delta = i.Position - dragStart
        toggleBtn.Position = UDim2.new(
            startPos.X.Scale, startPos.X.Offset + delta.X,
            startPos.Y.Scale, startPos.Y.Offset + delta.Y
        )
    end
end)

UserInputService.InputEnded:Connect(function(i)
    if i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
end)

--== MAIN PANEL (Miranda UI) ==--
local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0,430,0,260)
mainFrame.Position = UDim2.new(0.5,-215,0.5,-130)
mainFrame.BackgroundColor3 = Color3.fromRGB(18, 20, 28)
mainFrame.BackgroundTransparency = 0.25
mainFrame.Visible = false
mainFrame.Parent = gui

-- Bo 5%
local mainCorner = Instance.new("UICorner", mainFrame)
mainCorner.CornerRadius = UDim.new(0.05, 0)

-- Glow neon m·∫£nh nh∆∞ Miranda
local glow = Instance.new("UIStroke", mainFrame)
glow.Thickness = 1.5
glow.Color = Color3.fromRGB(0,255,170)
glow.Transparency = 0.35

-- Gradient n·ªÅn ki·ªÉu k√≠nh t·ªëi Miranda
local gradient = Instance.new("UIGradient", mainFrame)
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(25,25,35)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(35,35,50))
})
gradient.Rotation = 90

toggleBtn.MouseButton1Click:Connect(function()
    mainFrame.Visible = not mainFrame.Visible
end)

--== TITLE ==--
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1,0,0,45)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBlack
title.TextSize = 24
title.TextColor3 = Color3.fromRGB(0,255,170)
title.Text = "CRASHXMATRIX CONTROL"
title.Parent = mainFrame

--== FOOTER STATUS ==--
local footer = Instance.new("TextLabel")
footer.Size = UDim2.new(1,0,0,25)
footer.Position = UDim2.new(0,0,1,-25)
footer.BackgroundTransparency = 1
footer.Font = Enum.Font.GothamSemibold
footer.TextSize = 16
footer.TextColor3 = Color3.fromRGB(170,255,190)
footer.Text = "Status: ‚úÖ"
footer.Parent = mainFrame

--== BUTTON HOLDER ==--
local holder = Instance.new("Frame")
holder.Size = UDim2.new(1,0,1,-70)
holder.Position = UDim2.new(0,0,0,50)
holder.BackgroundTransparency = 1
holder.Parent = mainFrame

--== BUTTON CREATOR (Miranda Style) ==--
local function createButton(name, posY)
    local btn = Instance.new("Frame")
    btn.Size = UDim2.new(0,360,0,46)
    btn.Position = UDim2.new(0.5,-180,0,posY)
    btn.BackgroundColor3 = Color3.fromRGB(30,32,40)
    btn.Parent = holder

    local corner = Instance.new("UICorner", btn)
    corner.CornerRadius = UDim.new(.05, 0)

    local stroke = Instance.new("UIStroke", btn)
    stroke.Thickness = 1
    stroke.Color = Color3.fromRGB(0,255,170)
    stroke.Transparency = 0.4

    local lbl = Instance.new("TextButton")
    lbl.Size = UDim2.new(1,0,1,0)
    lbl.Text = name
    lbl.BackgroundTransparency = 1
    lbl.Font = Enum.Font.GothamMedium
    lbl.TextSize = 20
    lbl.TextColor3 = Color3.fromRGB(230,230,240)
    lbl.Parent = btn

    lbl.MouseEnter:Connect(function()
        TweenService:Create(btn, TweenInfo.new(.15),
            {BackgroundColor3 = Color3.fromRGB(40,45,55)}):Play()
    end)
    lbl.MouseLeave:Connect(function()
        TweenService:Create(btn, TweenInfo.new(.15),
            {BackgroundColor3 = Color3.fromRGB(30,32,40)}):Play()
    end)

    return lbl
end

-- Buttons
local crashBtn = createButton("Crash Player üëæ", 10)
local antiBtn = createButton("Anti Crash üõ°Ô∏è", 70)

--== GET CLOSEST PLAYER ==--
local function getClosestPlayer()
    local root = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    if not root then return nil end

    local closest, dist = nil, math.huge
    for _,plr in ipairs(Players:GetPlayers()) do
        if plr ~= player and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            local d = (plr.Character.HumanoidRootPart.Position - root.Position).Magnitude
            if d < dist then
                dist = d
                closest = plr
            end
        end
    end
    return closest
end

--== CRASH LOGIC ==--
crashBtn.MouseButton1Click:Connect(function()
    coroutine.wrap(function()
        crashBtn.Text = "Crashing..."
        task.wait(1.5)
        local t = getClosestPlayer()
        crashBtn.Text = "Crash Player: "..(t and t.Name or "None")
        task.wait(2)
        crashBtn.Text = "Crash Player üëæ"
    end)()
end)

--== MIRANDA LOADING SCREEN FOR ANTI-CRASH ==--
local function playAntiCrashLoading()
    local loadingGui = Instance.new("ScreenGui")
    loadingGui.Parent = PlayerGui
    loadingGui.IgnoreGuiInset = true

    local bg = Instance.new("Frame")
    bg.Size = UDim2.new(1,0,1,0)
    bg.BackgroundColor3 = Color3.new(0,0,0)
    bg.Parent = loadingGui

    local title = Instance.new("TextLabel")
    title.Size = UDim2.new(1,0,0,80)
    title.Position = UDim2.new(0,0,0.35,0)
    title.BackgroundTransparency = 1
    title.Text = "Anti Crash üõ°Ô∏è"
    title.Font = Enum.Font.GothamBlack
    title.TextSize = 42
    title.TextColor3 = Color3.fromRGB(0,255,170)
    title.Parent = bg

    local bar = Instance.new("Frame")
    bar.Size = UDim2.new(.35,0,0,12)
    bar.Position = UDim2.new(.325,0,.53,0)
    bar.BackgroundColor3 = Color3.fromRGB(40,40,40)
    bar.Parent = bg
    Instance.new("UICorner", bar).CornerRadius = UDim.new(1,0)

    local fill = Instance.new("Frame")
    fill.Size = UDim2.new(0,0,1,0)
    fill.BackgroundColor3 = Color3.fromRGB(0,255,170)
    fill.Parent = bar
    Instance.new("UICorner", fill).CornerRadius = UDim.new(1,0)

    TweenService:Create(fill, TweenInfo.new(2, Enum.EasingStyle.Linear),
        {Size = UDim2.new(1,0,1,0)}):Play()

    task.wait(2)
    TweenService:Create(bg, TweenInfo.new(.3), {BackgroundTransparency = 1}):Play()
    task.wait(.3)
    loadingGui:Destroy()
end

antiBtn.MouseButton1Click:Connect(function()
    footer.Text = "Anti Crash üõ°Ô∏è Active"
    playAntiCrashLoading()
    footer.Text = "Status: ‚úÖ"
end)
