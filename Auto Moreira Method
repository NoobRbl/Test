-- Auto Moreira Method 
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Láº¥y tÃªn ngÆ°á»i sá»­ dá»¥ng script + icon ðŸŸ¢
local function getUserTitle()
    local name = "User"
    if player then
        if player.DisplayName and player.DisplayName ~= "" then
            name = player.DisplayName
        elseif player.Name and player.Name ~= "" then
            name = player.Name
        end
    end
    return name .. " ðŸŸ¢"
end

-- Remove old
local OLD_NAME = "AutoMoreiraPanel_Full"
local old = playerGui:FindFirstChild(OLD_NAME)
if old then old:Destroy() end

---------------------------------------------------------------------
-- Helper UI functions
---------------------------------------------------------------------
local function addCorner(obj, radius)
    local c = Instance.new("UICorner")
    c.CornerRadius = UDim.new(0, radius or 10)
    c.Parent = obj
    return c
end

local function addStroke(obj, thickness, color, transparency)
    local s = Instance.new("UIStroke")
    s.Thickness = thickness or 1
    s.Color = color or Color3.fromRGB(255,255,255)
    s.Transparency = transparency or 0.5
    s.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    s.Parent = obj
    return s
end

local function addGradient(obj, c1, c2, rot)
    local g = Instance.new("UIGradient")
    g.Color = ColorSequence.new(c1, c2)
    g.Rotation = rot or 90
    g.Parent = obj
    return g
end

local function tween(obj, time, props, style, dir)
    local ti = TweenInfo.new(time, style or Enum.EasingStyle.Quad, dir or Enum.EasingDirection.Out)
    return TweenService:Create(obj, ti, props)
end

---------------------------------------------------------------------
-- ScreenGui
---------------------------------------------------------------------
local screenGui = Instance.new("ScreenGui")
screenGui.Name = OLD_NAME
screenGui.ResetOnSpawn = false
screenGui.IgnoreGuiInset = true
screenGui.Parent = playerGui

---------------------------------------------------------------------
-- Main frame
---------------------------------------------------------------------
local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 340, 0, 420)
frame.Position = UDim2.new(0.5, -170, 0.5, -210)
frame.BackgroundColor3 = Color3.fromRGB(12, 14, 20)
frame.Active = true
frame.Draggable = true
frame.Parent = screenGui
addCorner(frame, 14)
addStroke(frame, 1.2, Color3.fromRGB(120,130,200), 0.35)
addGradient(frame, Color3.fromRGB(18, 22, 34), Color3.fromRGB(8, 10, 16), 90)

---------------------------------------------------------------------
-- Top bar
---------------------------------------------------------------------
local topBar = Instance.new("Frame")
topBar.Size = UDim2.new(1, 0, 0, 42)
topBar.BackgroundColor3 = Color3.fromRGB(18, 24, 42)
topBar.BorderSizePixel = 0
topBar.Parent = frame
addCorner(topBar, 14)
addStroke(topBar, 1, Color3.fromRGB(140,150,220), 0.15)
addGradient(topBar, Color3.fromRGB(70, 95, 255), Color3.fromRGB(30, 40, 120), 0)

local title = Instance.new("TextLabel")
title.Parent = topBar
title.BackgroundTransparency = 1
title.Position = UDim2.new(0, 14, 0, 2)
title.Size = UDim2.new(1, -80, 0, 24)
title.Font = Enum.Font.GothamBold
title.TextSize = 18
title.TextXAlignment = Enum.TextXAlignment.Left
title.TextColor3 = Color3.fromRGB(255,255,255)
title.Text = "Auto Moreira Method"

local titleSub = Instance.new("TextLabel")
titleSub.Parent = topBar
titleSub.BackgroundTransparency = 1
titleSub.Position = UDim2.new(0, 14, 0, 22)
titleSub.Size = UDim2.new(1, -80, 0, 18)
titleSub.Font = Enum.Font.Gotham
titleSub.TextSize = 12
titleSub.TextXAlignment = Enum.TextXAlignment.Left
titleSub.TextColor3 = Color3.fromRGB(190,195,230)
titleSub.Text = getUserTitle() -- tÃªn ngÆ°á»i dÃ¹ng + ðŸŸ¢

local closeBtn = Instance.new("TextButton")
closeBtn.Parent = topBar
closeBtn.Text = "âœ•"
closeBtn.Font = Enum.Font.GothamBold
closeBtn.TextSize = 18
closeBtn.TextColor3 = Color3.fromRGB(240,240,255)
closeBtn.BackgroundTransparency = 1
closeBtn.AutoButtonColor = false
closeBtn.Size = UDim2.new(0, 32, 1, 0)
closeBtn.Position = UDim2.new(1, -36, 0, 0)

closeBtn.MouseEnter:Connect(function()
    tween(closeBtn, 0.15, {TextColor3 = Color3.fromRGB(255, 105, 120)}):Play()
end)

closeBtn.MouseLeave:Connect(function()
    tween(closeBtn, 0.15, {TextColor3 = Color3.fromRGB(240, 240, 255)}):Play()
end)

closeBtn.MouseButton1Click:Connect(function()
    screenGui:Destroy()
end)

---------------------------------------------------------------------
-- Status line
---------------------------------------------------------------------
local statusRow = Instance.new("Frame")
statusRow.Parent = frame
statusRow.Size = UDim2.new(1, -32, 0, 26)
statusRow.Position = UDim2.new(0, 16, 0, 50)
statusRow.BackgroundTransparency = 1
statusRow.BorderSizePixel = 0

local statusDot = Instance.new("Frame")
statusDot.Parent = statusRow
statusDot.Size = UDim2.new(0, 10, 0, 10)
statusDot.Position = UDim2.new(0, 0, 0.5, -5)
statusDot.BackgroundColor3 = Color3.fromRGB(255, 80, 95)
addCorner(statusDot, 8)
addStroke(statusDot, 1, Color3.fromRGB(255,150,170), 0.15)

local status = Instance.new("TextLabel")
status.Parent = statusRow
status.Size = UDim2.new(1, -18, 1, 0)
status.Position = UDim2.new(0, 16, 0, 0)
status.BackgroundTransparency = 1
status.Font = Enum.Font.GothamMedium
status.TextSize = 14
status.TextXAlignment = Enum.TextXAlignment.Left
status.TextColor3 = Color3.fromRGB(215,220,245)
status.Text = "Status: âœ… Ready"

---------------------------------------------------------------------
-- Auto Block + Bypass
---------------------------------------------------------------------
local badgesCol = Instance.new("Frame")
badgesCol.Parent = frame
badgesCol.Size = UDim2.new(1, -32, 0, 48)
badgesCol.Position = UDim2.new(0, 16, 0, 80)
badgesCol.BackgroundTransparency = 1

local autoBlockBadge = Instance.new("Frame")
autoBlockBadge.Parent = badgesCol
autoBlockBadge.Size = UDim2.new(1, 0, 0, 22)
autoBlockBadge.Position = UDim2.new(0, 0, 0, 0)
autoBlockBadge.BackgroundColor3 = Color3.fromRGB(10, 30, 18)
addCorner(autoBlockBadge, 999)
addStroke(autoBlockBadge, 1, Color3.fromRGB(70, 200, 120), 0.25)
addGradient(autoBlockBadge, Color3.fromRGB(20, 70, 40), Color3.fromRGB(10, 35, 22), 0)

local autoBlockText = Instance.new("TextLabel")
autoBlockText.Parent = autoBlockBadge
autoBlockText.BackgroundTransparency = 1
autoBlockText.Size = UDim2.new(1, -10, 1, 0)
autoBlockText.Position = UDim2.new(0, 8, 0, 0)
autoBlockText.Font = Enum.Font.GothamSemibold
autoBlockText.TextSize = 13
autoBlockText.TextXAlignment = Enum.TextXAlignment.Left
autoBlockText.TextColor3 = Color3.fromRGB(90, 255, 140)
autoBlockText.Text = "Auto Block: ON"

local bypassBadge = Instance.new("Frame")
bypassBadge.Parent = badgesCol
bypassBadge.Size = UDim2.new(1, 0, 0, 22)
bypassBadge.Position = UDim2.new(0, 0, 0, 26)
bypassBadge.BackgroundColor3 = Color3.fromRGB(10, 22, 36)
addCorner(bypassBadge, 999)
addStroke(bypassBadge, 1, Color3.fromRGB(90, 160, 255), 0.25)
addGradient(bypassBadge, Color3.fromRGB(26, 60, 110), Color3.fromRGB(12, 26, 44), 0)

local bypassText = Instance.new("TextLabel")
bypassText.Parent = bypassBadge
bypassText.BackgroundTransparency = 1
bypassText.Size = UDim2.new(1, -10, 1, 0)
bypassText.Position = UDim2.new(0, 8, 0, 0)
bypassText.Font = Enum.Font.GothamSemibold
bypassText.TextSize = 13
bypassText.TextXAlignment = Enum.TextXAlignment.Left
bypassText.TextColor3 = Color3.fromRGB(130, 190, 255)
bypassText.Text = "Bypass 30s cooldown: Successfully"

---------------------------------------------------------------------
-- Log panel
---------------------------------------------------------------------
local logCard = Instance.new("Frame")
logCard.Parent = frame
logCard.Size = UDim2.new(1, -32, 0, 190)
logCard.Position = UDim2.new(0, 16, 0, 132)
logCard.BackgroundColor3 = Color3.fromRGB(10, 12, 18)
logCard.BorderSizePixel = 0
addCorner(logCard, 10)
addStroke(logCard, 1, Color3.fromRGB(90, 100, 170), 0.35)

local logTop = Instance.new("Frame")
logTop.Parent = logCard
logTop.Size = UDim2.new(1, -16, 0, 22)
logTop.Position = UDim2.new(0, 8, 0, 6)
logTop.BackgroundTransparency = 1

local logTitle = Instance.new("TextLabel")
logTitle.Parent = logTop
logTitle.BackgroundTransparency = 1
logTitle.Size = UDim2.new(1, -90, 1, 0)
logTitle.Position = UDim2.new(0, 0, 0, 0)
logTitle.Font = Enum.Font.GothamSemibold
logTitle.TextSize = 13
logTitle.TextXAlignment = Enum.TextXAlignment.Left
logTitle.TextColor3 = Color3.fromRGB(190,195,230)
logTitle.Text = "Logs (console)"

local clearBtn = Instance.new("TextButton")
clearBtn.Parent = logTop
clearBtn.Size = UDim2.new(0, 90, 1, 0)
clearBtn.Position = UDim2.new(1, -92, 0, 0)
clearBtn.Text = "Clear Logs"
clearBtn.Font = Enum.Font.GothamBold
clearBtn.TextSize = 12
clearBtn.TextColor3 = Color3.fromRGB(255,255,255)
clearBtn.BackgroundColor3 = Color3.fromRGB(200,70,70)
clearBtn.AutoButtonColor = false
clearBtn.Visible = false
addCorner(clearBtn, 999)
addStroke(clearBtn, 1, Color3.fromRGB(255,120,120), 0.25)

clearBtn.MouseEnter:Connect(function()
    if not clearBtn.Visible then return end
    tween(clearBtn, 0.12, {BackgroundColor3 = Color3.fromRGB(220,90,90)}):Play()
end)

clearBtn.MouseLeave:Connect(function()
    if not clearBtn.Visible then return end
    tween(clearBtn, 0.12, {BackgroundColor3 = Color3.fromRGB(200,70,70)}):Play()
end)

local logScroll = Instance.new("ScrollingFrame")
logScroll.Parent = logCard
logScroll.Size = UDim2.new(1, -16, 1, -34)
logScroll.Position = UDim2.new(0, 8, 0, 28)
logScroll.BackgroundTransparency = 1
logScroll.CanvasSize = UDim2.new(0,0,0,0)
logScroll.ScrollBarThickness = 4
logScroll.BorderSizePixel = 0

local logsContainer = Instance.new("Frame")
logsContainer.Parent = logScroll
logsContainer.Size = UDim2.new(1,0,0,0)
logsContainer.BackgroundTransparency = 1

local uiList = Instance.new("UIListLayout")
uiList.Parent = logsContainer
uiList.SortOrder = Enum.SortOrder.LayoutOrder
uiList.Padding = UDim.new(0,2)

uiList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
    local h = uiList.AbsoluteContentSize.Y
    logsContainer.Size = UDim2.new(1,0,0,h)
    logScroll.CanvasSize = UDim2.new(0,0,0,h)
    logScroll.CanvasPosition = Vector2.new(0, math.max(0, h - logScroll.AbsoluteSize.Y))
end)

local logCount = 0
local logSequence = 0

clearBtn.MouseButton1Click:Connect(function()
    for _, child in ipairs(logsContainer:GetChildren()) do
        if child:IsA("Frame") and child.Name == "LogLine" then
            child:Destroy()
        end
    end
    logsContainer.Size = UDim2.new(1,0,0,0)
    logScroll.CanvasSize = UDim2.new(0,0,0,0)
    clearBtn.Visible = false
    logCount = 0
    logSequence = 0
end)

---------------------------------------------------------------------
-- Process bar + Start button
---------------------------------------------------------------------
local bottomArea = Instance.new("Frame")
bottomArea.Parent = frame
bottomArea.Size = UDim2.new(1, -32, 0, 80)
bottomArea.Position = UDim2.new(0, 16, 0, 326)
bottomArea.BackgroundTransparency = 1

local processCard = Instance.new("Frame")
processCard.Parent = bottomArea
processCard.Size = UDim2.new(1, 0, 0, 18)
processCard.Position = UDim2.new(0, 0, 0, 0)
processCard.BackgroundColor3 = Color3.fromRGB(9, 13, 24)
addCorner(processCard, 999)
addStroke(processCard, 1, Color3.fromRGB(70, 90, 170), 0.5)

local progressBack = Instance.new("Frame")
progressBack.Parent = processCard
progressBack.Size = UDim2.new(1, -4, 1, -4)
progressBack.Position = UDim2.new(0, 2, 0, 2)
progressBack.BackgroundColor3 = Color3.fromRGB(22, 26, 40)
progressBack.BackgroundTransparency = 1
addCorner(progressBack, 999)
addStroke(progressBack, 1, Color3.fromRGB(60, 80, 150), 0.7)

local progressFill = Instance.new("Frame")
progressFill.Parent = progressBack
progressFill.Size = UDim2.new(0, 0, 1, 0)
progressFill.BackgroundColor3 = Color3.fromRGB(93,118,255)
progressFill.BackgroundTransparency = 1
addCorner(progressFill, 999)
addGradient(progressFill, Color3.fromRGB(140,165,255), Color3.fromRGB(70,95,255), 0)

local startBtn = Instance.new("TextButton")
startBtn.Parent = bottomArea
startBtn.Text = "Start Moreira"
startBtn.Font = Enum.Font.GothamBold
startBtn.TextSize = 16
startBtn.TextColor3 = Color3.fromRGB(255,255,255)
startBtn.BackgroundColor3 = Color3.fromRGB(93,118,255)
startBtn.AutoButtonColor = false
startBtn.Size = UDim2.new(1, 0, 0, 34)
startBtn.Position = UDim2.new(0, 0, 0, 32)
addCorner(startBtn, 999)
addStroke(startBtn, 1.4, Color3.fromRGB(150,175,255), 0.1)
addGradient(startBtn, Color3.fromRGB(130,150,255), Color3.fromRGB(90,110,230), 0)

startBtn.MouseEnter:Connect(function()
    if not startBtn.Visible then return end
    tween(startBtn, 0.15, {BackgroundColor3 = Color3.fromRGB(110,135,255)}):Play()
end)

startBtn.MouseLeave:Connect(function()
    if not startBtn.Visible then return end
    tween(startBtn, 0.15, {BackgroundColor3 = Color3.fromRGB(93,118,255)}):Play()
end)

---------------------------------------------------------------------
-- FILTER OVERLAY
---------------------------------------------------------------------
local function showFilter(onDone)
    local overlay = Instance.new("Frame")
    overlay.Name = "FilterOverlay"
    overlay.Parent = screenGui
    overlay.Size = UDim2.new(1,0,1,0)
    overlay.BackgroundColor3 = Color3.fromRGB(0,0,0)
    overlay.BackgroundTransparency = 1
    overlay.ZIndex = 50

    local panel = Instance.new("Frame")
    panel.Size = UDim2.new(0, 260, 0, 220)
    panel.Position = UDim2.new(0.5, -130, 0.5, -110)
    panel.BackgroundColor3 = Color3.fromRGB(18,20,30)
    panel.BackgroundTransparency = 1
    panel.ZIndex = 51
    panel.Parent = overlay
    addCorner(panel, 12)
    addStroke(panel, 1, Color3.fromRGB(110,130,210), 0.3)

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Parent = panel
    titleLabel.BackgroundTransparency = 1
    titleLabel.Position = UDim2.new(0, 12, 0, 10)
    titleLabel.Size = UDim2.new(1, -24, 0, 24)
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 18
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.TextColor3 = Color3.fromRGB(235,240,255)
    titleLabel.ZIndex = 52
    titleLabel.Text = "Filter"

    local noteLabel = Instance.new("TextLabel")
    noteLabel.Parent = panel
    noteLabel.BackgroundTransparency = 1
    noteLabel.Position = UDim2.new(0, 12, 0, 38)
    noteLabel.Size = UDim2.new(1, -24, 0, 52)
    noteLabel.Font = Enum.Font.Gotham
    noteLabel.TextSize = 12
    noteLabel.TextWrapped = true
    noteLabel.TextXAlignment = Enum.TextXAlignment.Left
    noteLabel.TextYAlignment = Enum.TextYAlignment.Top
    noteLabel.TextColor3 = Color3.fromRGB(195,200,230)
    noteLabel.ZIndex = 52
    noteLabel.Text = "The higher the m+, the more good brainrot your base must be, otherwise no one will join. When choosing a high m+, it will take a long time for players to join."

    local buttonsFrame = Instance.new("Frame")
    buttonsFrame.Parent = panel
    buttonsFrame.BackgroundTransparency = 1
    buttonsFrame.Position = UDim2.new(0, 12, 0, 94)
    buttonsFrame.Size = UDim2.new(1, -24, 0, 120)
    buttonsFrame.ZIndex = 52

    local grid = Instance.new("UIGridLayout")
    grid.Parent = buttonsFrame
    grid.CellPadding = UDim2.new(0, 6, 0, 6)
    grid.CellSize = UDim2.new(0.5, -6, 0, 24)
    grid.FillDirection = Enum.FillDirection.Horizontal
    grid.SortOrder = Enum.SortOrder.LayoutOrder

    local filters = {"10m+","20m+","30m+","40m+","50m+","75m+","100m+","200m+"}

    for _, text in ipairs(filters) do
        local btn = Instance.new("TextButton")
        btn.Parent = buttonsFrame
        btn.BackgroundColor3 = Color3.fromRGB(70, 100, 220)
        btn.BorderSizePixel = 0
        btn.AutoButtonColor = false
        btn.Font = Enum.Font.GothamSemibold
        btn.TextSize = 13
        btn.TextColor3 = Color3.fromRGB(245,245,255)
        btn.Text = text
        btn.ZIndex = 53
        addCorner(btn, 8)

        btn.MouseEnter:Connect(function()
            tween(btn, 0.15, {BackgroundColor3 = Color3.fromRGB(85,115,235)}):Play()
        end)
        btn.MouseLeave:Connect(function()
            tween(btn, 0.15, {BackgroundColor3 = Color3.fromRGB(70,100,220)}):Play()
        end)

        btn.MouseButton1Click:Connect(function()
            local t1 = tween(overlay, 0.25, {BackgroundTransparency = 1})
            local t2 = tween(panel, 0.25, {BackgroundTransparency = 1})
            t1:Play()
            t2:Play()
            t2.Completed:Wait()
            overlay:Destroy()
            if onDone then
                onDone(text)
            end
        end)
    end

    local tIn1 = tween(overlay, 0.25, {BackgroundTransparency = 0.35})
    local tIn2 = tween(panel, 0.25, {BackgroundTransparency = 0})
    tIn1:Play()
    tIn2:Play()
end

---------------------------------------------------------------------
-- LOGIC: time, icons, logs, animateDots
---------------------------------------------------------------------
local function getTimePrefix()
    local t = os.date("*t")
    return string.format("[%02d:%02d:%02d] ", t.hour, t.min, t.sec)
end

local function chooseIcon(text)
    if string.find(text,"Successfully sent") then
        return "âœ…"
    elseif string.find(text,"Failed to sent") then
        return "âŒ"
    elseif string.find(text,"Please wait a moment") then
        return "â±ï¸"
    elseif string.find(text,"Waiting for Moreira Method") then
        return "âš™ï¸"
    elseif string.find(text,"Finished") then
        return "ðŸŽ‰"
    elseif string.find(text,"The player joined the server") or string.find(text,"The player has joined the server") then
        return "ðŸ‘¤"
    elseif string.find(text,"Filter applied") then
        return "ðŸŽšï¸"
    elseif string.find(text,"Starting auto%-scan") then
        return "ðŸ”"
    elseif string.find(text,"Starting scan") then
        return "ðŸ“¡"
    elseif string.find(text,"Scanned") then
        return "ðŸ§ "
    elseif string.find(text,"sending webhook") then
        return "ðŸŒ"
    elseif string.find(text,"Waiting for players to join") then
        return "â³"
    end
    return "â€¢"
end

local function pushLogLine(text, iconOverride)
    local row = Instance.new("Frame")
    row.Name = "LogLine"

    local rowHeight = 20
    if string.find(text, "Finished") then
        rowHeight = 32
    end

    row.BackgroundTransparency = 1
    row.Size = UDim2.new(1, 0, 0, rowHeight)
    row.Parent = logsContainer

    logSequence += 1
    row.LayoutOrder = logSequence

    local icon = iconOverride or chooseIcon(text)
    local prefix = getTimePrefix()
    local content = icon .. " " .. text

    local textLabel = Instance.new("TextLabel")
    textLabel.BackgroundTransparency = 1
    textLabel.Size = UDim2.new(1, -4, 1, 0)
    textLabel.Position = UDim2.new(0, 2, 0, 0)
    textLabel.Font = Enum.Font.Code
    textLabel.TextSize = 14
    textLabel.TextXAlignment = Enum.TextXAlignment.Left
    textLabel.Text = prefix .. content
    textLabel.TextColor3 = Color3.fromRGB(220, 230, 255)

    if string.find(text, "Finished") then
        textLabel.TextWrapped = true
        textLabel.TextYAlignment = Enum.TextYAlignment.Top
    else
        textLabel.TextWrapped = false
        textLabel.TextYAlignment = Enum.TextYAlignment.Center
    end

    textLabel.Parent = row

    if string.find(text,"Successfully sent") then
        textLabel.TextColor3 = Color3.fromRGB(108,255,148)
    elseif string.find(text,"Failed to sent") then
        textLabel.TextColor3 = Color3.fromRGB(255,120,135)
    elseif string.find(text,"Starting auto%-scan") then
        textLabel.TextColor3 = Color3.fromRGB(170,225,255)
    elseif string.find(text,"Starting scan") then
        textLabel.TextColor3 = Color3.fromRGB(150,205,255)
    elseif string.find(text,"Scanned") then
        textLabel.TextColor3 = Color3.fromRGB(210,190,255)
    elseif string.find(text,"sending webhook") then
        textLabel.TextColor3 = Color3.fromRGB(180,240,220)
    elseif string.find(text,"Please wait a moment") then
        textLabel.TextColor3 = Color3.fromRGB(150,190,255)
    elseif string.find(text,"Waiting") then
        textLabel.TextColor3 = Color3.fromRGB(108,178,255)
    elseif string.find(text,"Finished") then
        textLabel.TextColor3 = Color3.fromRGB(180,255,200)
    elseif string.find(text,"joined the server") then
        textLabel.TextColor3 = Color3.fromRGB(255,225,120)
    end

    clearBtn.Visible = true

    logCount += 1
    if logCount > 500 then
        local oldest = nil
        for _, c in ipairs(logsContainer:GetChildren()) do
            if c:IsA("Frame") and c.Name == "LogLine" then
                if not oldest or c.LayoutOrder < oldest.LayoutOrder then
                    oldest = c
                end
            end
        end
        if oldest then
            oldest:Destroy()
            logCount -= 1
        end
    end

    return textLabel
end

local function animateDots(label, duration)
    if not label then return end

    local original = label.Text or ""
    local prefix = ""
    local content = original

    local bracketPos = string.find(original, "] ")
    if bracketPos then
        prefix = string.sub(original, 1, bracketPos + 1)
        content = string.sub(original, bracketPos + 2)
    end

    local base = content:gsub("%.+$","")

    local startTime = tick()
    local dotCount = 0
    while tick() - startTime < duration and label.Parent do
        dotCount = (dotCount % 3) + 1
        local dots = string.rep(".", dotCount)
        label.Text = prefix .. base .. dots
        task.wait(0.35)
    end

    if label.Parent then
        label.Text = prefix .. base .. "..."
    end
end

---------------------------------------------------------------------
-- RANDOM HELPERS
---------------------------------------------------------------------
local function randomOddEven(minVal,maxVal)
    local num = math.random(minVal,maxVal)
    local chooseOdd = math.random(1,100) <= 70
    if chooseOdd then
        if num%2==0 then num=num+1 end
    else
        if num%2~=0 then num=num+1 end
    end
    return num
end

local function randomOddInRange(minVal,maxVal)
    local n = math.random(minVal,maxVal)
    if n % 2 == 0 then
        if n + 1 <= maxVal then
            n = n + 1
        else
            n = n - 1
        end
    end
    return n
end

local function getScannedCount(selectedFilter)
    if selectedFilter == "200m+" then
        return randomOddInRange(1000, 4000)
    elseif selectedFilter == "100m+" then
        return randomOddInRange(1000, 5000)
    elseif selectedFilter == "75m+" then
        return randomOddInRange(1000, 6000)
    elseif selectedFilter == "50m+" then
        return randomOddInRange(1000, 7000)
    elseif selectedFilter == "40m+" then
        return randomOddInRange(1000, 7500)
    elseif selectedFilter == "30m+" then
        return 8000
    elseif selectedFilter == "20m+" then
        return 8500
    elseif selectedFilter == "10m+" then
        return randomOddInRange(1000, 15000)
    else
        return randomOddInRange(1000, 10000)
    end
end

local function pickResults()
    local success = randomOddEven(700,1000)
    local fail    = randomOddEven(50,300)
    return success, fail
end

---------------------------------------------------------------------
-- STATE + player events
---------------------------------------------------------------------
local running = false
local waitingForPlayers = false
local brainrotActive = false

Players.PlayerAdded:Connect(function(plr)
    if waitingForPlayers and plr ~= player then
        pushLogLine("The player joined the serverðŸ“Ž")
        status.Text = "let's get brainrot"
        status.TextColor3 = Color3.fromRGB(255, 230, 140)
        tween(statusDot, 0.2, {
            BackgroundColor3 = Color3.fromRGB(255, 210, 90)
        }):Play()
        brainrotActive = true
    end
end)

Players.PlayerRemoving:Connect(function(plr)
    if brainrotActive and plr ~= player then
        status.Text = "Status: âœ… Ready"
        status.TextColor3 = Color3.fromRGB(190, 255, 200)
        tween(statusDot, 0.2, {
            BackgroundColor3 = Color3.fromRGB(110, 230, 130)
        }):Play()
        brainrotActive = false
    end
end)

---------------------------------------------------------------------
-- MAIN PROCESS
---------------------------------------------------------------------
local function startProcess(selectedFilter)
    if running then return end
    running = true
    waitingForPlayers = false
    brainrotActive = false

    if selectedFilter then
        pushLogLine("Filter applied: "..selectedFilter)
    end

    status.Text = "Status: ðŸŸ¡ Sending..."
    status.TextColor3 = Color3.fromRGB(230, 230, 180)
    tween(statusDot, 0.2, {
        BackgroundColor3 = Color3.fromRGB(255, 200, 90)
    }):Play()

    local hideTween = tween(startBtn, 0.3, {
        BackgroundTransparency = 1,
        TextTransparency = 1
    })
    hideTween:Play()
    hideTween.Completed:Wait()
    startBtn.Visible = false

    local lbl1 = pushLogLine("Starting auto-scan...")
    animateDots(lbl1, 2)

    local lbl2 = pushLogLine("Starting scan...")
    animateDots(lbl2, 3)

    local scannedCount = getScannedCount(selectedFilter)
    local lbl3 = pushLogLine("Scanned "..scannedCount.." objects")
    animateDots(lbl3, 2)

    local lbl4 = pushLogLine("sending webhook...")
    animateDots(lbl4, 2)

    progressBack.Visible = true
    progressFill.Visible = true
    tween(progressBack, 0.25, {BackgroundTransparency = 0}):Play()
    tween(progressFill, 0.25, {BackgroundTransparency = 0}):Play()

    pushLogLine("Waiting for Moreira Methodâš™ï¸")

    local infoCount = math.random(10,35)
    local successCount, failCount = pickResults()
    local totalLogs = infoCount + successCount + failCount
    local duration = 15
    local delayPerLog = duration/totalLogs
    local index = 0

    for i = 1, infoCount do
        index += 1
        pushLogLine("Please wait a moment for it to be sent to the server")
        tween(progressFill, 0.15, {
            Size = UDim2.new(index/totalLogs,0,1,0)
        }):Play()
        task.wait(delayPerLog)
    end

    local arr = {}
    for i = 1, successCount do table.insert(arr,"S") end
    for i = 1, failCount do table.insert(arr,"F") end
    for i = #arr, 2, -1 do
        local j = math.random(1,i)
        arr[i], arr[j] = arr[j], arr[i]
    end

    for _, v in ipairs(arr) do
        index += 1
        if v == "S" then
            pushLogLine("Successfully sent to a server")
        else
            pushLogLine("Failed to sent to a server")
        end
        tween(progressFill, 0.12, {
            Size = UDim2.new(index/totalLogs,0,1,0)
        }):Play()
        task.wait(delayPerLog)
    end

    pushLogLine(("Finished. Success(%d)  Fail(%d)"):format(successCount, failCount))

    status.Text = "Status: ðŸŸ¢ Finished"
    status.TextColor3 = Color3.fromRGB(190, 255, 200)
    tween(statusDot, 0.2, {
        BackgroundColor3 = Color3.fromRGB(110, 230, 130)
    }):Play()

    task.wait(2)
    pushLogLine("Waiting for players to join")
    waitingForPlayers = true

    local pbOut = tween(progressBack, 0.35, {BackgroundTransparency = 1})
    local pfOut = tween(progressFill, 0.35, {BackgroundTransparency = 1})
    pbOut:Play()
    pfOut:Play()
    pfOut.Completed:Wait()
    progressBack.Visible = false
    progressFill.Size = UDim2.new(0,0,1,0)

    startBtn.Visible = true
    startBtn.BackgroundTransparency = 1
    startBtn.TextTransparency = 1
    tween(startBtn, 0.35, {
        BackgroundTransparency = 0,
        TextTransparency = 0
    }):Play()

    if not brainrotActive then
        status.Text = "Status: âœ… Ready"
        status.TextColor3 = Color3.fromRGB(215,220,245)
        tween(statusDot, 0.2, {
            BackgroundColor3 = Color3.fromRGB(255, 80, 95)
        }):Play()
    end

    running = false
end

---------------------------------------------------------------------
-- START BUTTON
---------------------------------------------------------------------
startBtn.MouseButton1Click:Connect(function()
    if running then return end
    showFilter(function(selectedFilter)
        startProcess(selectedFilter)
    end)
end)
